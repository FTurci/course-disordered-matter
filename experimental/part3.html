<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>20&nbsp; Measurements in reciprocal space</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../experimental/part4.html" rel="next">
<link href="../soft-matter/soft-matter_problems.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-bd99fce104e3297f9650d28217f11d95.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="../site_libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../experimental/part3.html">Second experimental interlude</a></li><li class="breadcrumb-item"><a href="../experimental/part3.html"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Reciprocal-space measurements</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../courselogo.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../courselogo.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Recommended texts</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Unifying concepts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to phase behaviour</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Background concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/approach-to-criticality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">The approach to criticality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/Ising-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Ising model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/mean-field-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Mean field theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/scaling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The static scaling hypothesis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/rg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Universality and renormalization group theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/master-equation-and-diffusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Introduction to stochastic processes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/Brownian-and-Langevin-dynamics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Langevin and Brownian dynamics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/nucleation-and-growth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Nucleation, growth and spinodal decomposition</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/precourse-reading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Precourse reading and revision</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/problems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/Lecture Slides/Slides.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture slides</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/Solutions_partial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solutions to problems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../phase-transitions/assignment_October2025.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">First coursework assignment</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">First experimental interlude</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experimental/part1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Macroscopic measurements</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experimental/part2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Real-space measurements</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Complex disordered systems</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../soft-matter/soft-matter_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Entropy matters</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../soft-matter/soft-matter_colloids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Colloids</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../soft-matter/soft-matter_polymers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Polymers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../soft-matter/soft-matter_liquidcrystals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Liquid crystals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../soft-matter/soft-matter_surfactants.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Surfactants</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../soft-matter/soft-matter_glasses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Arrested states</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../soft-matter/soft-matter_active.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Active matter</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../soft-matter/slides.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture slides</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../soft-matter/soft-matter_problems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problems</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Second experimental interlude</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experimental/part3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Reciprocal-space measurements</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experimental/part4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Structure and dynamics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes as pdf</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#diffraction" id="toc-diffraction" class="nav-link active" data-scroll-target="#diffraction"><span class="header-section-number">20.1</span> Diffraction</a></li>
  <li><a href="#the-structure-factor---a-simple-approach." id="toc-the-structure-factor---a-simple-approach." class="nav-link" data-scroll-target="#the-structure-factor---a-simple-approach."><span class="header-section-number">20.2</span> The structure factor - a simple approach.</a></li>
  <li><a href="#the-relationship-between-sq-and-gr-for-a-disordered-material." id="toc-the-relationship-between-sq-and-gr-for-a-disordered-material." class="nav-link" data-scroll-target="#the-relationship-between-sq-and-gr-for-a-disordered-material."><span class="header-section-number">20.3</span> The relationship between <span class="math inline">\(S(Q)\)</span> and <span class="math inline">\(g(r)\)</span> for a disordered material.</a></li>
  <li><a href="#practical-points" id="toc-practical-points" class="nav-link" data-scroll-target="#practical-points"><span class="header-section-number">20.4</span> Practical points</a></li>
  <li><a href="#partial-structure-factors" id="toc-partial-structure-factors" class="nav-link" data-scroll-target="#partial-structure-factors"><span class="header-section-number">20.5</span> Partial Structure Factors</a></li>
  <li><a href="#diffraction-from-multicomponent-systems." id="toc-diffraction-from-multicomponent-systems." class="nav-link" data-scroll-target="#diffraction-from-multicomponent-systems."><span class="header-section-number">20.6</span> Diffraction from multicomponent systems.</a></li>
  <li><a href="#neutron-diffraction-and-isotope-substitution" id="toc-neutron-diffraction-and-isotope-substitution" class="nav-link" data-scroll-target="#neutron-diffraction-and-isotope-substitution"><span class="header-section-number">20.7</span> Neutron diffraction and isotope substitution</a></li>
  <li><a href="#difference-diffraction-experiments" id="toc-difference-diffraction-experiments" class="nav-link" data-scroll-target="#difference-diffraction-experiments"><span class="header-section-number">20.8</span> Difference diffraction experiments</a></li>
  <li><a href="#spectroscopy---exafs-xanes-nmr" id="toc-spectroscopy---exafs-xanes-nmr" class="nav-link" data-scroll-target="#spectroscopy---exafs-xanes-nmr"><span class="header-section-number">20.9</span> Spectroscopy - EXAFS, XANES, NMR …</a>
  <ul class="collapse">
  <li><a href="#exafs" id="toc-exafs" class="nav-link" data-scroll-target="#exafs"><span class="header-section-number">20.9.1</span> EXAFS</a></li>
  <li><a href="#xanes" id="toc-xanes" class="nav-link" data-scroll-target="#xanes"><span class="header-section-number">20.9.2</span> XANES</a></li>
  <li><a href="#nmr-spectroscopy" id="toc-nmr-spectroscopy" class="nav-link" data-scroll-target="#nmr-spectroscopy"><span class="header-section-number">20.9.3</span> NMR spectroscopy</a></li>
  <li><a href="#mossbauer-spectroscopy" id="toc-mossbauer-spectroscopy" class="nav-link" data-scroll-target="#mossbauer-spectroscopy"><span class="header-section-number">20.9.4</span> Mossbauer spectroscopy</a></li>
  <li><a href="#optical" id="toc-optical" class="nav-link" data-scroll-target="#optical"><span class="header-section-number">20.9.5</span> Optical</a></li>
  <li><a href="#ultraviolet-and-infrared-absorption" id="toc-ultraviolet-and-infrared-absorption" class="nav-link" data-scroll-target="#ultraviolet-and-infrared-absorption"><span class="header-section-number">20.9.6</span> Ultraviolet and infrared absorption</a></li>
  <li><a href="#other" id="toc-other" class="nav-link" data-scroll-target="#other"><span class="header-section-number">20.9.7</span> other</a></li>
  </ul></li>
  <li><a href="#full-modelling-techniques" id="toc-full-modelling-techniques" class="nav-link" data-scroll-target="#full-modelling-techniques"><span class="header-section-number">20.10</span> Full modelling techniques</a></li>
  <li><a href="#molecular-materials" id="toc-molecular-materials" class="nav-link" data-scroll-target="#molecular-materials"><span class="header-section-number">20.11</span> Molecular materials</a></li>
  <li><a href="#summary-and-keypoints" id="toc-summary-and-keypoints" class="nav-link" data-scroll-target="#summary-and-keypoints"><span class="header-section-number">20.12</span> Summary and keypoints</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../experimental/part3.html">Second experimental interlude</a></li><li class="breadcrumb-item"><a href="../experimental/part3.html"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Reciprocal-space measurements</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Measurements in reciprocal space</span></h1>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<section id="diffraction" class="level2" data-number="20.1">
<h2 data-number="20.1" class="anchored" data-anchor-id="diffraction"><span class="header-section-number">20.1</span> Diffraction</h2>
<p>In the previous section we saw how measurements of <span class="math inline">\(g(r)\)</span> may be made by directly finding coordinates of particles in space. We saw how this could be applied to colloidal systems. The optical methods applied are confined to systems at or close to the diffraction limit, that for optical wavelengths is a few hundred nanometres. Another problem that may arise is that <span class="math inline">\(g(r)\)</span> is a statistical quantity and to obtain meaningful results it must be calculated over a large number of particle positions and care must be taken to ensure that the system under study is homogeneous.</p>
<p>In order to determine <span class="math inline">\(g(r)\)</span> directly in a similar way for atomic and molecular systems we would need to use wavelengths that are much less than the atomic size, that is beyond X-ray wavelengths. This is not practical. In contrast, it is possible to image at the atomic scale using electron microscopy. However, in this case it is not possible to image in the bulk in a similar way to confocal microscopy and studies are largely limited to 2D surfaces. Hence, most studies at this scale are based on diffraction methods - the topic of this part of the course.</p>
<p>Optically, you are aware from your study of waves that diffraction effects occur when the scale of the structure is of the same order of the wavelength of light. The same principle applies for atomic scales which means diffraction needs wavelengths around 0.1 nanometres (or 1 Å) for atomic scale studies.</p>
<p>0.1 nm is in the X-ray regime but it’s also accessible with thermal neutrons (~ 300K is approximately 0.18 nm) or electrons. (Exercise. Calculate the energy of a photon, neutron and electron corresponding to a wavelength of 0.1 nm.).</p>
<p>So how do we use diffraction in disordered systems to obtain structural information such as <span class="math inline">\(g(r)\)</span>?</p>
</section>
<section id="the-structure-factor---a-simple-approach." class="level2" data-number="20.2">
<h2 data-number="20.2" class="anchored" data-anchor-id="the-structure-factor---a-simple-approach."><span class="header-section-number">20.2</span> The structure factor - a simple approach.</h2>
<p>We will not use a rigorous approach to diffraction (that requires quantum mechanics) but we will approach the relationship between the scattering of x-rays, neutrons and electrons by atoms by considering the following simple picture. We note that we haven’t included the strength or the specific way in which the atoms scatter at this point but have assumed an incoming quantum is scattered by the atoms. We also assume for the moment that we only have one atom type.</p>
<center>
<img src="part3_figs/diffraction1.png" alt="diffraction from pairs of atoms in the material" width="500">
</center>
<p>We then wish to understand how the scattered waves from different atoms interfere to give rise to a diffraction pattern (for example scattered intensity vs.&nbsp;angle).</p>
<center>
<img src="part3_figs/diffraction2.png" alt="diffraction from pairs of atoms in the material" width="500">
</center>
<p>We can write the structure factor (beware, if you are familiar with crystal diffraction, this is a different definition for the structure factor) for the scattering of all the atoms in the material as</p>
<center>
<img src="part3_figs/sofq.png" alt="Structure Factor" width="500">
</center>
<p>We note that <span class="math inline">\(N\)</span> is just a normalizing factor to give the scattering per atom and that for a liquid we need to take the spherical average of this function to return a function <span class="math inline">\(S(Q)\)</span> that is isotropic (the same in all directions). (NB. This latter step would not be taken, in for example representing the scattering from a liquid crystal, where we know there is an orientation of the molecules in the liquid - the director - even though there is still liquid like disorder in the other directions).</p>
<p>A more formal derivation of the structure factor obtained in a scattering experiment for a single element may be found in Fischer et al.&nbsp;2006 and may be written in terms of the <span class="math inline">\(\textit{differential scattering cross-section}\)</span>,</p>
<p><span class="math display">\[\frac{1}{N} \frac{d\sigma}{d\Omega}=b^2_{coh}S(Q)+b^2_{incoh}\]</span></p>
<p>for neutrons where <span class="math inline">\(b_{coh}\)</span> is the coherent scattering length of the element and <span class="math inline">\(b_{incoh}\)</span> is the incoherent scattering length that arises due to the difference in scattering by the nucleus when its nuclear spin (if it has a spin) is aligned or anti-aligned with the neutron and/or when it is different due to the nuclear scattering arising from different isotopes of the same element.</p>
<p>For the case of X-rays the corresponding quantity, in its simplest form is,</p>
<p><span class="math display">\[\frac{1}{N} \frac{d\sigma}{d\Omega}=f(Q)^2 S(Q)\]</span></p>
<p>where we note this is after corrections for the effects of polarization of the x-ray beam in the incident and scattered beam has been made.</p>
<center>
<img src="part3_figs/xrayvsneutron.png" alt="Comparison of X-ray and neutron scattering" width="800">
</center>
<p>From the figure we note the important difference between the neutron and X-ray diffraction patterns. At large values of <span class="math inline">\(Q\)</span> the neutron diffraction cross-section tends to a constant value <span class="math inline">\(b^2_{coh}+b^2_{incoh}\)</span> whereas for X-rays we see that the diffraction tends to zero at large <span class="math inline">\(Q\)</span> due to the <span class="math inline">\(Q\)</span> dependence of the X-ray form factor. The physical origin of this effect is that for neutrons it is the nucleus (with a size of a few femtometres) that is the scattering object whereas for X-rays it is the electron cloud around the atom (with dimensions of about a tenth of a nanometer) that is the scattering object. Hence for a thermal neutron (of wavelength 0.18 nm) the atoms in the material act as point scatterers whereas the scattering from X-rays is for an object of roughly the same wavelength. Hence the shape of <span class="math inline">\(f(Q)\)</span> reflects the distribution of the electrons around the atom. This <span class="math inline">\(Q\)</span> dependence of the form factor has important consequences when we consider materials composed of more than one element as we shall see shortly.</p>
<p>[The effect is equivalent in optics to the difference from the diffraction pattern from a grating that is composed of very narrow slits compared to one composed of slit widths on the same scale as their separation cf.</p>
<p><span class="math display">\[I\sim \left(\frac{\sin \alpha}{\alpha}\right)^2\left(\frac{\sin N\beta}{\sin\beta}\right)^2\]</span>]</p>
<p>We also note that both <span class="math inline">\(b\)</span> and <span class="math inline">\(f(Q)\)</span> should be considered as complex quantities (that give rise to absorption and alter the scattering cross-section close to a neutron resonance or X-ray absorption edge).</p>
<p>Hence, provided we are able to make the experimental corrections we can see that, at least for a single element, <span class="math inline">\(S(Q)\)</span> for the liquid or glass may be obtained directly.</p>
<p>Here are some images of some typical X-ray and neutron diffractometers at the ILL and ESRF central facilities.</p>
<center>
<img src="part3_figs/neutrondiffractometer.png" alt="Example of D4C neutron diffractometer" width="800">
</center>
<center>
<img src="part3_figs/xraydiffractometer.png" alt="Example of X-ray diffractometers at the ESRF" width="800">
</center>
</section>
<section id="the-relationship-between-sq-and-gr-for-a-disordered-material." class="level2" data-number="20.3">
<h2 data-number="20.3" class="anchored" data-anchor-id="the-relationship-between-sq-and-gr-for-a-disordered-material."><span class="header-section-number">20.3</span> The relationship between <span class="math inline">\(S(Q)\)</span> and <span class="math inline">\(g(r)\)</span> for a disordered material.</h2>
<p>The description above gives insight into the origins of the interference (diffraction) effects observed from a disordered arrangement of scatterers. There is a direct sine Fourier transform pair relationship between the radial distribution function <span class="math inline">\(g(r)\)</span> and the structure factor <span class="math inline">\(S(Q)\)</span> for the material and is as follows.</p>
<p><span class="math display">\[S(Q)=1+\frac{4\pi\rho}{Q}\int_0^{\infty}r(g(r)-1)\sin(Qr)dr\]</span></p>
<p>and</p>
<p><span class="math display">\[g(r)=1+\frac{1}{2\pi\rho r}\int_0^{\infty}Q(S(Q)-1)\sin(Qr)dQ\]</span></p>
<p>Again, we note that these quantities do not depend on the nature of the scattering. Hence, by measuring <span class="math inline">\(S(Q)\)</span> we can in principle obtain <span class="math inline">\(g(r)\)</span>.</p>
</section>
<section id="practical-points" class="level2" data-number="20.4">
<h2 data-number="20.4" class="anchored" data-anchor-id="practical-points"><span class="header-section-number">20.4</span> Practical points</h2>
<p>In practice it is not possible to measure the complete <span class="math inline">\(S(Q)\)</span> function in an experiment. Apart from statistical and systematic uncertainties in the measurements, we see the maximum value of <span class="math inline">\(Q\)</span> that can be measured is determined by the maximum scattering angle and the wavelength of the x-ray, neutron etc. So for <span class="math inline">\(2\theta= 180^\circ\)</span> (<span class="math inline">\(\pi\)</span>), the maximum possible scattering angle, we obtain <span class="math inline">\(Q_{\max}=\frac{4\pi}{\lambda}\)</span>, where <span class="math inline">\(\lambda\)</span> is the wavelength. We will also find there is a minimum value of <span class="math inline">\(Q\)</span>, <span class="math inline">\(Q_{\min}\)</span> that is determined by the divergence of the incident beam and the distance and shielding of the detector. Hence in the transform from <span class="math inline">\(S(Q)\)</span> to <span class="math inline">\(g(r)\)</span> the limits are <span class="math inline">\(Q_{\min}\)</span> and <span class="math inline">\(Q_{\max}\)</span> that are determined by experimental constraints.</p>
<p><span class="math inline">\(Q_{\min}\)</span> sets the limit on the extent of the long-range structure that we may observe. For example, correlations at long length scales could give rise to peaks that occur below <span class="math inline">\(Q_{\min}\)</span> and hence be unobservable. So, if the aim of your study is to look at long-range correlations (i.e.&nbsp;between large molecules for example) you aim to get as low in <span class="math inline">\(Q\)</span> as possible. This is usually achieved by using longer wavelength X-rays or neutrons. For example, for neutron scattering, experiments to observe small <span class="math inline">\(Q\)</span> scattering (sometimes misleadingly termed small angle scattering) instruments use neutrons from a ‘cold source’ of neutrons (typically from a moderator using liquid deuterium (25K or ~ 4Å) at the ILL or liquid methane (50K) at ISIS. For X-rays you would select sources and instruments optimised for X-ray wavelengths below 10 keV.</p>
<p><span class="math inline">\(Q_{\max}\)</span> determines the amount of detail you can see at shorter ranges. If it is not high enough you won’t be able to resolve anything on the atomic length scales. A general rule of thumb for disordered materials is you need to measure to the point where there appears to be no structure in the diffraction pattern at the highest <span class="math inline">\(Q\)</span> values. Hence X-ray and neutron diffractometers for studying atomic materials and in particularly glasses use short wavelength neutrons or X-rays. For neutrons, the neutrons are obtained from a ‘hot source’ moderator (the graphite moderator at the ILL works at 3000K and has the maximum flux at about 0.5 Å) or the instruments are designed to exploit the high energy epi-thermal neutrons from a pulse source (i.e.&nbsp;ISIS). The more locally ordered the material (for example an oxide glass versus a high temperature liquid) the higher in <span class="math inline">\(Q\)</span> one needs to go. For the hot source instruments you typically get 23 Å<span class="math inline">\(^{-1}\)</span>. For pulsed neutron sources <span class="math inline">\(Q\)</span> values of 50 Å<span class="math inline">\(^{-1}\)</span> may be achieved.</p>
<p>At this point, hopefully, you should see the difficulty - optimising for <span class="math inline">\(Q_{\min}\)</span> compromises your high <span class="math inline">\(Q_{\max}\)</span> and vice versa for single wavelength instruments. Hence, you typically need to make a careful choice of instrument or instruments depending on the material to be studied.</p>
<p>The situation at ‘time of flight’ neutron sources (such as ISIS) is slightly different as it is possible to simultaneously obtain lower <span class="math inline">\(Q_{\min}\)</span> and higher <span class="math inline">\(Q_{\max}\)</span> than using a single wavelength diffractometer. We don’t have time to go into details here but needless to say there are further experimental difficulties to consider when you go down that route.</p>
</section>
<section id="partial-structure-factors" class="level2" data-number="20.5">
<h2 data-number="20.5" class="anchored" data-anchor-id="partial-structure-factors"><span class="header-section-number">20.5</span> Partial Structure Factors</h2>
<p>As we noted previously, the discussion so far has only considered mono-atomic systems - a very limited case! In reality we deal with materials that contain more than one atom type and hence we need a way to describe the arrangements of different types of atom around each other. i.e.&nbsp;How do we interpret the diffraction pattern from a multicomponent system? Well, we can extend our idea of the radial distribution function and introduce the idea of a partial radial distribution function, <span class="math inline">\(g_{\alpha\beta}(r)\)</span>, which may be described as the radial distribution function for the arrangement of atoms of type <span class="math inline">\(\beta\)</span> around those of type <span class="math inline">\(\alpha\)</span>. We note also that <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> can represent the same atom type. Take for example a glass such as germanium dioxide (<span class="math inline">\(GeO_2\)</span>). We can define four partial radial distribution functions, <span class="math inline">\(g_{GeGe}(r)\)</span> describing the distribution of the germanium atoms around a germanium atom at the origin, <span class="math inline">\(g_{OO}(r)\)</span> describing the distribution of oxygen atoms around an oxygen atom at the origin and <span class="math inline">\(g_{GeO}(r)\)</span> describing the distribution of oxygen atoms around a germanium atom at the origin and vice versa (<span class="math inline">\(g_{OGe}(r)\)</span>). With a little thought we can also see that <span class="math inline">\(g_{GeO}(r)=g_{OGe}(r)\)</span> so that for our binary system we only need 3 partial radial distribution functions to describe the structure. Extending the arguments we used previously, we may then define the partial structure <span class="math inline">\(S_{\alpha\beta}(Q)\)</span> as,</p>
<p><span class="math display">\[S_{\alpha\beta}(Q)=1+ \frac{4\pi\rho}{Q}\int_0^{\infty}r(g_{\alpha\beta}(r)-1)\sin(Qr)dr\]</span></p>
<p>for which the inverse transform is,</p>
<p><span class="math display">\[g_{\alpha\beta}(r)=1+\frac{1}{2\pi\rho r}\int_0^{\infty}Q(S_{\alpha\beta}(Q)-1)\sin(Qr)dQ\]</span></p>
</section>
<section id="diffraction-from-multicomponent-systems." class="level2" data-number="20.6">
<h2 data-number="20.6" class="anchored" data-anchor-id="diffraction-from-multicomponent-systems."><span class="header-section-number">20.6</span> Diffraction from multicomponent systems.</h2>
<p>We see each <span class="math inline">\(S_{\alpha\beta}(Q)\)</span> that are related to the positions of the diffracting pairs above, will contribute to the diffraction pattern for our multicomponent system. We expect the contribution to the intensity from each <span class="math inline">\(S_{\alpha\beta}(Q)\)</span> to depend on the strength of the scattering from the atom type involved (i.e.&nbsp;<span class="math inline">\(b_{coh}\)</span> or <span class="math inline">\(f(Q)\)</span>) and its concentration (<span class="math inline">\(c_\alpha\)</span> and <span class="math inline">\(c_\beta\)</span>). So, in the case of a multicomponent system we write our scattering cross-section (again after experimental corrections) as,</p>
<p><span class="math display">\[\frac{1}{N} \frac{d\sigma}{d\Omega}=\sum_{\alpha=1}^N\sum_{\beta=1}^Nc_{\alpha}c_{\beta}b_{coh,\alpha}b_{coh,\beta}S_{\alpha\beta}(Q)+\sum_{\alpha=1}^Nb^2_{\alpha,incoh}\]</span></p>
<p>for the case of neutron scattering.</p>
<p>This may be re-written as</p>
<p><span class="math display">\[\frac{1}{N} \frac{d\sigma}{d\Omega}=F^N(Q)+\sum_{\alpha=1}^N\sum_{\beta=1}^Nc_{\alpha}c_{\beta}b_{coh,\alpha}b_{coh,\beta}+\sum_{\alpha=1}^Nb^2_{\alpha,incoh}\]</span></p>
<p>where we have defined</p>
<p><span class="math display">\[F^N(Q)=\sum_{\alpha=1}^N\sum_{\beta=1}^Nc_{\alpha}c_{\beta}b_{coh,\alpha}b_{coh,\beta}(S_{\alpha\beta}(Q)-1)\]</span></p>
<p>For the case of X-ray scattering we have</p>
<p><span class="math display">\[\frac{1}{N} \frac{d\sigma}{d\Omega}=\sum_{\alpha=1}^N\sum_{\beta=1}^Nc_{\alpha}c_{\beta}f_{\alpha}(Q)f_{\beta}(Q)S_{\alpha\beta}(Q)\]</span></p>
<p>or</p>
<p><span class="math display">\[\frac{1}{N} \frac{d\sigma}{d\Omega}=F^X(Q)+\sum_{\alpha=1}^N\sum_{\beta=1}^Nc_{\alpha}c_{\beta}f_{\alpha}(Q)f_{\beta}(Q)\]</span></p>
<p>where,</p>
<p><span class="math display">\[F^X(Q)=\sum_{\alpha=1}^N\sum_{\beta=1}^Nc_{\alpha}c_{\beta}f_{\alpha}(Q)f_{\beta}(Q)(S_{\alpha\beta}(Q)-1)\]</span></p>
<p>Hence we see <span class="math inline">\(F^N(Q)\)</span> and <span class="math inline">\(F^X(Q)\)</span> contain all the structure information in the scattering but at the same time we see that the individual partial structure factors can not be isolated in a single diffraction pattern. The sine Fourier transform of <span class="math inline">\(F^N(Q)\)</span> gives,</p>
<p><span class="math display">\[G^N(r)=\sum_{\alpha=1}^N\sum_{\beta=1}^Nc_{\alpha}c_{\beta}b_{coh,\alpha}b_{coh,\beta}+\frac{1}{2\pi\rho r}\int_0^{\infty}F^N(Q)\sin(Qr)dQ\]</span></p>
<p>or,</p>
<p><span class="math display">\[G^N(r)=\sum_{\alpha=1}^N\sum_{\beta=1}^Nc_{\alpha}c_{\beta}b_{coh,\alpha}b_{coh,\beta}+\sum_{\alpha=1}^N\sum_{\beta=1}^Nc_{\alpha}c_{\beta}b_{coh,\alpha}b_{coh,\beta}(g_{\alpha\beta}(r)-1)\]</span></p>
<p>where we’ve applied the sine Fourier transform of <span class="math inline">\(F^N(Q)\)</span> to get the total radial distribution function that is just the weighted sum of the partial radial distribution functions. For X-rays the equivalent sine Fourier transform,</p>
<p><span class="math display">\[\frac{1}{2\pi\rho r}\int_0^{\infty}F^X(Q)\sin(Qr)dQ\]</span></p>
<p>is no longer a linear combination of the partial radial distribution functions as the <span class="math inline">\(Q\)</span> dependence of the form factors acts as a ‘modification’ function on the transform that has the effect of broadening the peaks in real space. Also, as the <span class="math inline">\(Q\)</span> dependence of the form factors is different for each element (related to the size of the atom) the effect of this broadening will be different for each <span class="math inline">\(g_{\alpha\beta}(r)\)</span>. In much experimental x-ray work this broadening effect is often reduced by dividing <span class="math inline">\(F^X(Q)\)</span> by the weighted sum of the form factor terms. This has the effect of reducing the peak broadening at the expense of some distortion in the partial <span class="math inline">\(g(r)\)</span>s.</p>
</section>
<section id="neutron-diffraction-and-isotope-substitution" class="level2" data-number="20.7">
<h2 data-number="20.7" class="anchored" data-anchor-id="neutron-diffraction-and-isotope-substitution"><span class="header-section-number">20.7</span> Neutron diffraction and isotope substitution</h2>
<p>We have seen that it is not possible, in a single neutron or X-ray diffraction experiment, to obtain the partial radial distribution functions of a disordered material. So in a simple measurement, the interpretation (e.g.&nbsp;assignment of bond distances, coordination numbers …) of <span class="math inline">\(G(r)\)</span> is by assignment and fitting overlapping peaks. More recently, rather than fitting peaks, the trend is for data to be directly compared to the structures calculated from computer simulations (Monte Carlo or Molecular Dynamics) and/or by refining (by fitting) the simulation structures to obtain agreement with the experimental data. However, both methods inevitably limit the precision of the structure determination possible.</p>
<center>
<img src="part3_figs/geo2total.png" alt="Total structure factor and g(r) for GeO2" width="800">
</center>
<p>However, as we have seen, the neutron scattering cross-section depends on the properties of the nucleus of the atom, that is in itself dependent on the atomic weight, and not the atomic number of the element in question. In particular, <span class="math inline">\(b_{coh}\)</span> depends on the isotope of the element. Hence, the scattering cross-section of a material will be different if its isotopic composition is changed. However, its chemical properties will remain unchanged. This difference in scattering from different isotopes is exploited in the technique of neutron diffraction and isotopic substitution (NDIS). Take for example our <span class="math inline">\(GeO_2\)</span> glass. We can make this glass from Germanium with its natural abundance of elements or we can use isotopically enriched samples made with Ge<span class="math inline">\(^{70}\)</span> and Ge<span class="math inline">\(^{73}\)</span>. The different coherent neutron scattering lengths for oxygen and these germanium isotopes are shown in the table below.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">isotope</th>
<th style="text-align: center;">scattering length /fm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Ge (Natural)</td>
<td style="text-align: center;">8.185</td>
</tr>
<tr class="even">
<td style="text-align: center;">Ge (70)</td>
<td style="text-align: center;">10.00</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Ge (73)</td>
<td style="text-align: center;">5.02</td>
</tr>
<tr class="even">
<td style="text-align: center;">O (Natural)</td>
<td style="text-align: center;">5.802</td>
</tr>
</tbody>
</table>
<p>The concentrations of the germanium and oxygen atoms are <span class="math inline">\(c_{Ge}=1/2\)</span> and <span class="math inline">\(c_O=2/3\)</span> so the relative weightings of the three partial structure factors in <span class="math inline">\(F^N\)</span> are different for the differently isotopically labelled samples so that the diffraction pattern observed will be different for each case. We can express the difference in matrix form</p>
<p><span class="math display">\[\begin{pmatrix} 0.074&amp;0.150&amp;0.211\\0.110&amp;0.150&amp;0.256\\0.030&amp;0.150&amp;0.133\end{pmatrix}\begin{pmatrix}S_{GeGe}(Q)\\S_{OO}(Q)\\S_{GeO}(Q)\end{pmatrix}=\begin{pmatrix}F^N_{nat}(Q)\\F^N_{70}(Q)\\F^N_{73}(Q)\end{pmatrix}\]</span></p>
<p>from which we can see that we have three measurements (the <span class="math inline">\(F^N(Q)\)</span> for the different isotope compositions) and three unknowns (the partial <span class="math inline">\(S_{\alpha\beta}(Q)\)</span>). Hence, we can determine <span class="math inline">\(S_{GeGe}(Q)\)</span>, <span class="math inline">\(S_{OO}(Q)\)</span> and <span class="math inline">\(S_{GeO}(Q)\)</span> by multiplying the left and right side of this equation by the inverse matrix to obtain,</p>
<p><span class="math display">\[\begin{pmatrix}S_{GeGe}(Q)\\S_{OO}(Q)\\S_{GeO}(Q)\end{pmatrix}=\begin{pmatrix} -171&amp;108&amp;63\\-65&amp;34&amp;38\\111&amp;-62&amp;-49\end{pmatrix}\begin{pmatrix}F^N_{nat}(Q)\\F^N_{70}(Q)\\F^N_{73}(Q)\end{pmatrix}\]</span></p>
<p>The figures below show the measured <span class="math inline">\(F^N(Q)\)</span> for these isotopically labelled glasses and the partial structure factors obtained by this matrix inversion. The <span class="math inline">\(g_{\alpha\beta}(r)\)</span> obtained by Fourier transform of the partial structure is shown below in addition to the total <span class="math inline">\(G(r)\)</span> for the natural sample.</p>
<center>
<img src="part3_figs/geo2partialsq.png" alt="Partial structure factors for GeO2" width="800">
</center>
<center>
<img src="part3_figs/geo2partialgr.png" alt="Partial g(r) for GeO2" width="800">
</center>
<p>It is important to note some of the limitations of this method</p>
<ul>
<li>not all elements have isotopes or isotopes with large differences in scattering length,</li>
<li>isotopically enriched elements are very expensive, tens of thousands of dollars per gram,</li>
<li>even with good scattering length variation, the scattering matrix is still typically poorly conditioned (see the statistical errors on the data above),</li>
<li>it is only realistic for binary systems, the scattering matrix for ternary (3x3) or higher compounds is poor even for the best isotopes available.</li>
</ul>
<p>One variation that was demonstrated for <span class="math inline">\(GeO_2\)</span> is to consider an X-ray diffraction measurement as one of the ‘isotopic’ compositions. In this case the inverse matrix will vary with <span class="math inline">\(Q\)</span> due to the X-ray form factors, but the partial structure factors can still be formally calculated using the inverse matrix at each <span class="math inline">\(Q\)</span> point.</p>
</section>
<section id="difference-diffraction-experiments" class="level2" data-number="20.8">
<h2 data-number="20.8" class="anchored" data-anchor-id="difference-diffraction-experiments"><span class="header-section-number">20.8</span> Difference diffraction experiments</h2>
<p>As noted above, the number of cases where formal inversion to partial structures may be obtained is very limited. However, difference or contrast techniques are much more commonly applied. In this case, a single isotopic change is made in the material. Inspection of the weightings then shows that a simple subtraction of one diffraction pattern from the other (provided they are properly corrected and normalised) removes all correlations apart from those that involve the substituted atom. In addition, by suitable weighting of one pattern it is possible to remove all the contributions from the substituted atom apart from <span class="math inline">\(S_{\alpha\alpha}(Q)\)</span> (which is generally small anyway).</p>
<p>These difference techniques have been used extensively in the study of the hydration of ions in aqueous solutions and the coordination of metal ions in oxide glasses to name a few.</p>
<p>A related technique - X-ray anomalous (resonant) scattering - where variations in <span class="math inline">\(f(Q)\)</span> has been exploited in a few cases.</p>
</section>
<section id="spectroscopy---exafs-xanes-nmr" class="level2" data-number="20.9">
<h2 data-number="20.9" class="anchored" data-anchor-id="spectroscopy---exafs-xanes-nmr"><span class="header-section-number">20.9</span> Spectroscopy - EXAFS, XANES, NMR …</h2>
<p>Diffraction experiments, especially when used with substitution techniques give structural information to large <span class="math inline">\(r\)</span> in <span class="math inline">\(g(r)\)</span>. However, the techniques can be difficult and expensive to carry out. Hence spectroscopic techniques, that are usually very sensitive to local atomic configurations, are also used extensively in the study of disordered materials. In this case there is no direct inversion of the measurement to real space to give <span class="math inline">\(g(r)\)</span>. The different coordination structures give rise to different spectral features. These are used to identify and possibly refine the local structure to obtain good agreement with the measurements. Problems in interpretation may arise due to the difficulty of including statistical variations in the local structures into the analysis method. Nevertheless, spectroscopic measurements are usually very sensitive to small changes taking place in the material on heating etc. that may not be detected easily in diffraction experiments. To fully describe any of these techniques would take several lectures each so we list them here briefly with a short description.</p>
<section id="exafs" class="level3" data-number="20.9.1">
<h3 data-number="20.9.1" class="anchored" data-anchor-id="exafs"><span class="header-section-number">20.9.1</span> EXAFS</h3>
<p>Typical X-ray energies are high enough to eject electrons from their core atomic (usually K or L) shells. The energy is dependent on the atomic number (getting larger with <span class="math inline">\(N\)</span>). At this energy there is a sudden jump in the absorption of the X-rays - the so called absorption edge. The probability of the absorption of the X-ray is dependent on the final state the ejected electron can occupy. For liquids and solids (including glasses) the final electron states available depends on the atomic arrangements around the absorbing atom. This difference in absorption gives rise to characteristic oscillations in the X-ray absorption above the edge. This is known as Extended X-ray Absorption Fine Structure (EXAFS). The signal can be interpreted in a simple way by Fourier transform of these oscillations to give a near neighbour distance. More sophisticated methods are based on calculation and fitting of model local structures. The statistical nature of the local arrangement around the target atoms makes an accurate interpretation of the EXAFS signal for disordered materials difficult and the correct interpretation is still often debated.</p>
</section>
<section id="xanes" class="level3" data-number="20.9.2">
<h3 data-number="20.9.2" class="anchored" data-anchor-id="xanes"><span class="header-section-number">20.9.2</span> XANES</h3>
<p>X-ray Absorption Near Edge Structure (XANES) corresponds to structure in the absorption spectrum close to the absorption edge. Accurate interpretation is difficult due to the complexity of the calculations needed to model the edge structure but certain key features in the spectrum are characteristic of strong local coordination structures and/or the valence state of the absorbing atom.</p>
</section>
<section id="nmr-spectroscopy" class="level3" data-number="20.9.3">
<h3 data-number="20.9.3" class="anchored" data-anchor-id="nmr-spectroscopy"><span class="header-section-number">20.9.3</span> NMR spectroscopy</h3>
<p>There are various Nuclear Magnetic Resonance techniques that arise from the induced precession of nuclear moments in applied magnetic fields. As in the case of X-ray absorption the resonance is affected by the structure and movement of the neighbouring atoms. For example, in silicate glasses the N.M.R. signal gives a strong indication of for example the number of oxygen atoms and their spatial arrangement around for example the Si atoms. This provides important information about the <span class="math inline">\(\textit{network connectivity}\)</span> and its relation to the glass forming ability and fragility. The N.M.R. signal may also be sensitive to the movement (diffusion) of neighbouring atoms and so can be used as a probe of the atom dynamics as we will see in the next section. It should be noted that only a select number of element isotopes are suitable for N.M.R. spectroscopy.</p>
</section>
<section id="mossbauer-spectroscopy" class="level3" data-number="20.9.4">
<h3 data-number="20.9.4" class="anchored" data-anchor-id="mossbauer-spectroscopy"><span class="header-section-number">20.9.4</span> Mossbauer spectroscopy</h3>
<p>This technique requires isotopes of an element that emit (and can also absorb) gamma ray photons in a very narrow energy range defined by the nuclear energy levels. Due to the conservation of momentum a free atom will emit a gamma ray photon at just below its resonance energy as the nucleus needs to recoil by the conservation of momentum. In contrast a free nucleus needs slightly more energy than the resonance energy as the absorbing atom also needs to recoil. This means that gamma rays emitted by free atoms are unable to be absorbed by similar atoms. However, when the emitting atoms are in a solid they are no longer free and the energy has to be absorbed by the material by the emission of excitations (phonons) with discrete energies. With some probability it is possible for the atoms to emit and absorb in a recoil free manner (no phonon excited/absorbed). Hence, in a solid there is a probability that the emitted gamma ray may be absorbed by the sample - a quantity that may be measured. This is the basis of Mossbauer spectroscopy as it is sensitive to the local environment of the absorbing/emitting atoms. Again, not all elements have suitable isotopes, however for some, like <span class="math inline">\(^{57}\)</span>Fe, Mossbauer spectroscopy is a very commonly applied technique.</p>
</section>
<section id="optical" class="level3" data-number="20.9.5">
<h3 data-number="20.9.5" class="anchored" data-anchor-id="optical"><span class="header-section-number">20.9.5</span> Optical</h3>
<p>For certain elements the optical absorption and emission by ions may be dependent on the local environment so the colour of the liquid or glass may also depend on the local environment. This is typically observed in transition metal or rare earth liquids or glasses. Photons may also cause or absorb excitations (phonons) in solid materials. This absorption/emission may be measured and is the basis of the Raman spectroscopy - a technique that rapidly developed after the development of highly monochromatic laser sources although the original measurements were made with sunlight! As with the other methods the Raman spectra may be used to infer information about the local structure.</p>
</section>
<section id="ultraviolet-and-infrared-absorption" class="level3" data-number="20.9.6">
<h3 data-number="20.9.6" class="anchored" data-anchor-id="ultraviolet-and-infrared-absorption"><span class="header-section-number">20.9.6</span> Ultraviolet and infrared absorption</h3>
<p>Away from the optical region materials, especially organic materials show characteristic absorption in the infrared and ultraviolet region with energies typical of bond energies in organic materials. Commercial equipment is readily available for these techniques.</p>
</section>
<section id="other" class="level3" data-number="20.9.7">
<h3 data-number="20.9.7" class="anchored" data-anchor-id="other"><span class="header-section-number">20.9.7</span> other</h3>
<p>The above is not an exhaustive list of techniques that may be used, other techniques might include Electron Spin Resonance (ESR), dielectric susceptibility, magnetic susceptibility. Can you find reference to any others?</p>
</section>
</section>
<section id="full-modelling-techniques" class="level2" data-number="20.10">
<h2 data-number="20.10" class="anchored" data-anchor-id="full-modelling-techniques"><span class="header-section-number">20.10</span> Full modelling techniques</h2>
<p>From the discussion above it should be apparent that none of the techniques mentioned provide a magic bullet that can tell you everything about the material in question. Diffraction methods are good at identifying the overall structure of the material but apart from neutron diffraction and isotopic substitution it can’t give information about specific correlations in the material. Even for the latter the information is limited by available isotopes, statistical precision and the need for expensive neutron sources. In contrast, spectroscopic methods give information about and are very sensitive to the local structure around target atoms but are typically constrained to use calculations and fitting the data to pre-defined models.</p>
<p>In the last few decades computer simulation of disordered structures with Monte-Carlo or Molecular Dynamics simulations has moved from being a specialised field needing expensive computer resources and theoretical knowledge to calculations that can be done on a typical desktop or laptop computer using well established potentials. Increasingly, such simulations may be used as the starting point in the interpretation of experimental data. For example, if there is a good agreement between the measured diffraction data and the structure predicted by simulation it gives validity and utility to the potentials etc. used in the calculations. In particular, the more diffraction data included (X-ray, neutron etc.) the more stringent this validation becomes. Similarly, spectroscopic signals may also be calculated from the simulation data as a validation procedure. The figure below shows the comparison of experimental data obtained by NDIS compared with a Molecular Dynamics simulation (using potentials) and an Ab Initio Molecular Dynamics simulations in which the atomic interactions are calculated directly from quantum calculations.</p>
<center>
<img src="part3_figs/datacompare.png" alt="Comparison of Ag2Se data with simulation" width="800">
</center>
<p>The ultimate aim of the experiment and simulations would be a structure that is self consistent with all the techniques exploited. Computer methods that are moving to this goal are the latest implementation of Reverse Monte Carlo fitting (where atomic positions in a model structure are continually adjusted to obtain good fits to, for example, diffraction and EXAFS data simultaneously) or the Empirical Potential Structural Refinement (EPSR) where molecular dynamic potentials are dynamically adjusted until the simulation agrees with experimental measurement.</p>
</section>
<section id="molecular-materials" class="level2" data-number="20.11">
<h2 data-number="20.11" class="anchored" data-anchor-id="molecular-materials"><span class="header-section-number">20.11</span> Molecular materials</h2>
<p>What happens when we wish to look at the structure of materials at a coarser scale than the atomic resolution, for example, large molecular or polymeric systems? This is an interesting question and might be phrased in a slightly different manner - at what point is it unnecessary to consider the atomic nature of a material? As you might imagine it is all a matter of scale. If I asked how the plastic balls in a child’s play pit arranged themselves it would be hard to expect you to give an interpretation based on interatomic potentials. I’d imagine them as rigid hollow spheres surrounded by a very low density fluid (air).</p>
<p>So, what techniques might we use as we move up from the scale of atoms (<span class="math inline">\(\sim\)</span> 0.1 nm) to molecules (1-10 nm)? Well in our discussion of X-ray and neutron diffraction so far we saw that we needed to measure the scattering to quite wide angles (<span class="math inline">\(&gt;90^\circ\)</span>) in order to have enough range in <span class="math inline">\(Q\)</span> to resolve the interatomic structure. If we look at the typical structure for a simple atomic liquid we see that the scattering at small <span class="math inline">\(Q\)</span> becomes smaller and tends towards zero (not quite true - it depends on the compressibility) as <span class="math inline">\(Q\rightarrow 0\)</span>. Indeed, the first peak in our diffraction pattern is typically around <span class="math inline">\(Q\sim (2\pi/d)\)</span> where <span class="math inline">\(d\)</span> is the shortest interatomic distance. This reflects the observation that the peaks in <span class="math inline">\(g(r)\)</span> steadily decrease as <span class="math inline">\(r\)</span> increases. Now suppose we imagine our system consists of molecular spherical ‘balls’ of the order of 4 nm in diameter. Our wide angle diffraction pattern will arise primarily from all interatomic distances in the molecule. However, there will be large regions (the gaps between the balls) where there are no atoms to scatter the X-rays or neutrons. We have seen a similar situation before - X-rays are scattered from the electrons and the scattering from the atom was interpreted in terms of the X-ray form factor that describes the distribution of the electrons in the atom. For both neutrons and X-rays we now have an analogous situation, the scattering from our molecular ball will depend on the distribution of the scattering centres in our molecule that we can describe as a form factor for the molecule (like <span class="math inline">\(f(Q)\)</span> for x-rays). If we imagine our diffraction pattern from our system of molecular balls we can see a diffraction peak corresponding to the inter ball (intramolecular) spacing at <span class="math inline">\(Q\sim 2\pi/4 \sim 1.5\)</span> nm<span class="math inline">\(^{-1}\)</span> (as the balls are 2 nm in radius and hence separated by 4 nm if they are in contact) superimposed on the decreasing molecular form factor followed by the interatomic part at high <span class="math inline">\(Q\)</span>.</p>
<p>So the answer to our question is that if we are studying molecular systems, for example, liquid crystals, micelles etc. then we need to either change our probe to use lower energy (longer wavelength) neutrons or X-rays or concentrate our efforts at measuring the diffraction pattern at small angles (or both). Hence, in principle, we could apply many of the transform techniques described above (but on a different length scale) <span class="math inline">\(\textit{provided}\)</span> we know the molecular form factor. Unfortunately, molecules don’t generally form a nice ‘ball’, they are not necessarily spherical and they may distort so this won’t work! Sometimes useful approximations can be made - for example a typical idea is the radius of gyration (<span class="math inline">\(R_g\)</span>) of the molecule i.e.&nbsp;approximating its scattering to a spherical object. However, the field of small angle scattering from molecular systems is vast and many approaches are taken to the analysis of results that we do not have time to cover.</p>
<p>Neutron scattering is also a very powerful technique for studying these systems. There is a very large difference in the scattering lengths of normal hydrogen <span class="math inline">\(^1_1H\)</span> and its heavier deuterium isotope <span class="math inline">\(^2_1H\)</span>. By selectively ‘deuterating’ molecules or parts of molecules the scattering at small angles from two otherwise identical samples may be enhanced to highlight the structure of disordered molecular systems at this intermolecular mesoscopic scale - a technique that has been used extensively to understand and optimise materials for the food and cosmetic industries to name a few.</p>
<p>As we increase the size of our components the principles of diffraction stay the same - we aim to use wavelengths that are comparable to the size of the scattering objects. This is not always easy as other effects including absorption and refraction may come into play. However, it is possible to diffract radio waves from arrays of macroscopic reflectors for example and you are already very familiar with optical diffraction from 2D arrangements of diffracting objects with sizes comparable to the wavelength of light.</p>
</section>
<section id="summary-and-keypoints" class="level2" data-number="20.12">
<h2 data-number="20.12" class="anchored" data-anchor-id="summary-and-keypoints"><span class="header-section-number">20.12</span> Summary and keypoints</h2>
<p>As we approach atomic sizes attempts to measure structural properties in real space (<span class="math inline">\(g(r)\)</span>) become harder and harder. In this regime the main tools for measuring structure are X-ray and neutron diffraction and perhaps electron diffraction in certain cases. In addition, spectroscopic measurements may be used and are sensitive to the local environments around different atom types.</p>
<p>In diffraction experiments important factors to consider are,</p>
<ul>
<li>the wavelength of the x-ray or neutrons,</li>
<li>the maximum and minimum accessible <span class="math inline">\(Q\)</span> value compared to the length scales being probed,</li>
<li>the accessibility of the source (central facilities needed?),</li>
<li>cost and availability of isotopes.</li>
</ul>
<p>In spectroscopic experiments important factors include,</p>
<ul>
<li>the sensitivity of the technique for the atom type in question,</li>
<li>cost and accessibility of the desired spectrometers,</li>
<li>difficulty of analysing the data and the accuracy (rather than sensitivity) of the method for obtaining i.e.&nbsp;<span class="math inline">\(g(r)\)</span>.</li>
</ul>


<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
W10=
</script>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../experimental";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../soft-matter/soft-matter_problems.html" class="pagination-link" aria-label="Problems">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Problems</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../experimental/part4.html" class="pagination-link" aria-label="Structure and dynamics">
        <span class="nav-page-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Structure and dynamics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>